<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 16.0.0"/>
    <title>PyMPDATA API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#49483e}.pdoc-code{background:#272822; color:#f8f8f2}.pdoc-code .c{color:#75715e}.pdoc-code .err{color:#960050; background-color:#1e0010}.pdoc-code .esc{color:#f8f8f2}.pdoc-code .g{color:#f8f8f2}.pdoc-code .k{color:#66d9ef}.pdoc-code .l{color:#ae81ff}.pdoc-code .n{color:#f8f8f2}.pdoc-code .o{color:#f92672}.pdoc-code .x{color:#f8f8f2}.pdoc-code .p{color:#f8f8f2}.pdoc-code .ch{color:#75715e}.pdoc-code .cm{color:#75715e}.pdoc-code .cp{color:#75715e}.pdoc-code .cpf{color:#75715e}.pdoc-code .c1{color:#75715e}.pdoc-code .cs{color:#75715e}.pdoc-code .gd{color:#f92672}.pdoc-code .ge{color:#f8f8f2; font-style:italic}.pdoc-code .gr{color:#f8f8f2}.pdoc-code .gh{color:#f8f8f2}.pdoc-code .gi{color:#a6e22e}.pdoc-code .go{color:#66d9ef}.pdoc-code .gp{color:#f92672; font-weight:bold}.pdoc-code .gs{color:#f8f8f2; font-weight:bold}.pdoc-code .gu{color:#75715e}.pdoc-code .gt{color:#f8f8f2}.pdoc-code .kc{color:#66d9ef}.pdoc-code .kd{color:#66d9ef}.pdoc-code .kn{color:#f92672}.pdoc-code .kp{color:#66d9ef}.pdoc-code .kr{color:#66d9ef}.pdoc-code .kt{color:#66d9ef}.pdoc-code .ld{color:#e6db74}.pdoc-code .m{color:#ae81ff}.pdoc-code .s{color:#e6db74}.pdoc-code .na{color:#a6e22e}.pdoc-code .nb{color:#f8f8f2}.pdoc-code .nc{color:#a6e22e}.pdoc-code .no{color:#66d9ef}.pdoc-code .nd{color:#a6e22e}.pdoc-code .ni{color:#f8f8f2}.pdoc-code .ne{color:#a6e22e}.pdoc-code .nf{color:#a6e22e}.pdoc-code .nl{color:#f8f8f2}.pdoc-code .nn{color:#f8f8f2}.pdoc-code .nx{color:#a6e22e}.pdoc-code .py{color:#f8f8f2}.pdoc-code .nt{color:#f92672}.pdoc-code .nv{color:#f8f8f2}.pdoc-code .ow{color:#f92672}.pdoc-code .w{color:#f8f8f2}.pdoc-code .mb{color:#ae81ff}.pdoc-code .mf{color:#ae81ff}.pdoc-code .mh{color:#ae81ff}.pdoc-code .mi{color:#ae81ff}.pdoc-code .mo{color:#ae81ff}.pdoc-code .sa{color:#e6db74}.pdoc-code .sb{color:#e6db74}.pdoc-code .sc{color:#e6db74}.pdoc-code .dl{color:#e6db74}.pdoc-code .sd{color:#e6db74}.pdoc-code .s2{color:#e6db74}.pdoc-code .se{color:#ae81ff}.pdoc-code .sh{color:#e6db74}.pdoc-code .si{color:#e6db74}.pdoc-code .sx{color:#e6db74}.pdoc-code .sr{color:#e6db74}.pdoc-code .s1{color:#e6db74}.pdoc-code .ss{color:#e6db74}.pdoc-code .bp{color:#f8f8f2}.pdoc-code .fm{color:#a6e22e}.pdoc-code .vc{color:#f8f8f2}.pdoc-code .vg{color:#f8f8f2}.pdoc-code .vi{color:#f8f8f2}.pdoc-code .vm{color:#f8f8f2}</style>
    <style>/*! theme.css */:root{--pdoc-background:#212529;}.pdoc{--text:#f7f7f7;--muted:#9d9d9d;--link:#58a6ff;--link-hover:#3989ff;--code:#333;--active:#555;--accent:#343434;--accent2:#555;--nav-hover:rgba(0, 0, 0, 0.1);--name:#77C1FF;--def:#0cdd0c;--annotation:#00c037;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note{color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.tip{color:#0a3622;background-color:#d1e7dd;border-color:#a3cfbb;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%230a3622%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%206a6%206%200%201%201%2010.174%204.31c-.203.196-.359.4-.453.619l-.762%201.769A.5.5%200%200%201%2010.5%2013a.5.5%200%200%201%200%201%20.5.5%200%200%201%200%201l-.224.447a1%201%200%200%201-.894.553H6.618a1%201%200%200%201-.894-.553L5.5%2015a.5.5%200%200%201%200-1%20.5.5%200%200%201%200-1%20.5.5%200%200%201-.46-.302l-.761-1.77a2%202%200%200%200-.453-.618A5.98%205.98%200%200%201%202%206m6-5a5%205%200%200%200-3.479%208.592c.263.254.514.564.676.941L5.83%2012h4.342l.632-1.467c.162-.377.413-.687.676-.941A5%205%200%200%200%208%201%22/%3E%3C/svg%3E");}.pdoc .alert.important{color:#055160;background-color:#cff4fc;border-color:#9eeaf9;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23055160%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M2%200a2%202%200%200%200-2%202v12a2%202%200%200%200%202%202h12a2%202%200%200%200%202-2V2a2%202%200%200%200-2-2zm6%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.caution{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M11.46.146A.5.5%200%200%200%2011.107%200H4.893a.5.5%200%200%200-.353.146L.146%204.54A.5.5%200%200%200%200%204.893v6.214a.5.5%200%200%200%20.146.353l4.394%204.394a.5.5%200%200%200%20.353.146h6.214a.5.5%200%200%200%20.353-.146l4.394-4.394a.5.5%200%200%200%20.146-.353V4.893a.5.5%200%200%200-.146-.353zM8%204c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%204.995A.905.905%200%200%201%208%204m.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:27px;vertical-align:bottom;width:50px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */img{max-width:100%;}mark{background-color:#859bed;color:black;}ul{margin-left:2em;}</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="index.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;
                Module Index
            </a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>

            <h2>Contents</h2>
            <ul>
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#tutorial-in-python-julia-rust-and-matlab">Tutorial (in Python, Julia, Rust and Matlab)</a>
  <ul>
    <li><a href="#options-class">Options class</a></li>
    <li><a href="#arakawa-c-grid-layer-and-boundary-conditions">Arakawa-C grid layer and boundary conditions</a></li>
    <li><a href="#stepper">Stepper</a></li>
    <li><a href="#solver">Solver</a></li>
  </ul></li>
  <li><a href="#debugging">Debugging</a></li>
  <li><a href="#contributing-reporting-issues-seeking-support">Contributing, reporting issues, seeking support</a></li>
  <li><a href="#other-open-source-mpdata-implementations">Other open-source MPDATA implementations:</a></li>
  <li><a href="#other-python-packages-for-solving-hyperbolic-transport-equations">Other Python packages for solving hyperbolic transport equations</a></li>
</ul>


            <h2>Submodules</h2>
            <ul>
                    <li><a href="PyMPDATA/boundary_conditions.html">boundary_conditions</a></li>
                    <li><a href="PyMPDATA/impl.html">impl</a></li>
                    <li><a href="PyMPDATA/options.html">options</a></li>
                    <li><a href="PyMPDATA/scalar_field.html">scalar_field</a></li>
                    <li><a href="PyMPDATA/solver.html">solver</a></li>
                    <li><a href="PyMPDATA/stepper.html">stepper</a></li>
                    <li><a href="PyMPDATA/vector_field.html">vector_field</a></li>
            </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22160%22%20viewBox%3D%220%200%20150%2080%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M132.316%2048.886c.276-4.679%202.342-6.698%204.409-7.982s4.27-1.165%206.751-1.055c1.586.07%203.044.156%204.222-.482%201.142-.619%202.026-1.932%202.162-3.739.268-3.576-1.929-5.368-5.006-5.551s-7.599.524-10.517%201.606c-4.455%201.652-8.588%206.606-9.552%208.992s-2.342%206.193-1.745%2010.873%202.664%209.221%205.878%2011.79%205.878%203.808%2010.103%204.312%203.444.229%206.062.229%205.006-2.202%204.914-4.909-2.296-5.001-4.501-4.863-3.077.505-5.281.229-7.715-2.064-7.899-9.451z%22%20fill%3D%22%23198754%22/%3E%3Ccircle%20cx%3D%22101.504%22%20cy%3D%2248.943%22%20r%3D%2214.208%22%20fill%3D%22none%22%20stroke%3D%22%23198754%22%20stroke-width%3D%229.354%22/%3E%3Cpath%20d%3D%22M87.81.002c-3.637.065-5.001.454-7.014%201.232s-3.443%201.363-6.3%204.282c-1.723%201.76-3.148%205.019-3.776%207.329-.413%201.521-.316%202.63-.316%202.63l-.195%2034.612c.065%205.774-6.755%208.305-9.612%208.37s-9.678-1.038-9.743-9.408%207.128-9.521%208.362-9.521c1.413-.13%202.526-.021%203.718-.016%202.071.009%204.157-.778%204.092-4.671s-4.157-4.736-4.157-4.736c-6.3-.843-11.43%202.206-11.43%202.206S40.917%2038.15%2041.372%2049.634%2051.568%2068.19%2061.311%2068.125s18.316-7.007%2018.445-17.193l.13-22.772c.046-2.291%202.683-3.644%204.476-4.203.745-.232%201.694-.274%201.694-.274l10.457-.13s4.871-.324%207.729-3.114%204.352-6.294%204.352-6.294.974-3.049.13-4.606-.195-1.233-2.792-3.309-8.573-4.477-8.573-4.477S91.447-.063%2087.81.002zM0%2047.169l.065%2028.417S0%2080.127%204.481%2079.997s5.072-3.866%205.049-4.152l-.113-28.482s1.624-7.656%209.937-7.721%2010.002%206.942%2010.002%208.499-.909%2010.51-9.093%2010.51c-.948%200-2.99-.567-4.145-.272-3.919%201-3.194%204.554-3.194%204.554s.065%205.061%207.404%204.996%2018.575-6.034%2018.575-19.074S26.953%2030.04%2019.549%2029.91%201.234%2035.296%200%2047.169z%22%20fill%3D%22%23198754%22/%3E%3Cg%20transform%3D%22matrix%28.325601%200%200%20.325256%20-10.32669%20-45.802786%29%22%3E%3Ccircle%20cx%3D%22297.554%22%20cy%3D%22172.286%22%20r%3D%2216.5%22%20fill%3D%22%23fff%22/%3E%3Cellipse%20cx%3D%22297.709%22%20cy%3D%22172.642%22%20rx%3D%2211.071%22%20ry%3D%2210.871%22%20fill%3D%22%23105a48%22/%3E%3Ccircle%20cx%3D%22304.104%22%20cy%3D%22167.667%22%20r%3D%224.5%22%20fill%3D%22%23fff%22/%3E%3C/g%3E%3Cpath%20d%3D%22M94.661%2017.032l.893-1.476s.99.714%201.916.925%201.575.114%202.955.114l14.565-.162c1.283-.032%203.085-.762%203.02-3.293s-.373-3.503-.373-3.503l1.283-.487s.52.503.877%201.573.309%201.995.292%202.66-.227%201.541-.227%201.541%201.564-.308%202.359-1.038.823-.779%201.489-1.508.812-.86.812-.86.552-.13.877.26.341.957.065%201.46-1.672%202.206-3.247%203.066-2.76%201.427-3.929%201.768-3.848.73-7.063.714l-10.944-.114s-2.143-.081-3.02-.373-2.241-.973-2.598-1.265z%22%20fill%3D%22%23d36d49%22/%3E%3Cg%20fill%3D%22%23105a48%22%3E%3Cellipse%20cx%3D%2293.052%22%20cy%3D%2243.567%22%20rx%3D%22.869%22%20ry%3D%221.014%22%20transform%3D%22rotate%28341.022%29%22/%3E%3Cellipse%20cx%3D%22104.3%22%20cy%3D%22-16.184%22%20rx%3D%22.865%22%20ry%3D%221.009%22%20transform%3D%22rotate%2814.786%29%22/%3E%3C/g%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
PyMPDATA    </h1>

                        <div class="docstring"><p><img src="https://raw.githubusercontent.com/open-atmos/PyMPDATA/main/.github/pympdata_logo.svg" width=100 height=113 alt="pympdata logo"></p>

<h1 id="introduction">Introduction</h1>

<p>PyMPDATA is a high-performance <a href="https://doi.org/10.1145/2833157.2833162">Numba-accelerated</a> Pythonic implementation of the MPDATA
  algorithm of <a href="https://doi.org/10.1016%2F0021-9991%2884%2990121-9">Smolarkiewicz et al.</a>
  used in geophysical fluid dynamics and beyond.
MPDATA numerically solves generalised transport equations -
  partial differential equations used to model conservation/balance laws, scalar-transport problems,
  convection-diffusion phenomena.
As of the current version, PyMPDATA supports homogeneous transport
  in 1D, 2D and 3D using structured meshes, optionally
  generalised by employment of a Jacobian of coordinate transformation or a fluid density profile.
PyMPDATA includes implementation of a set of MPDATA variants including
  the non-oscillatory option, infinite-gauge, divergent-flow, double-pass donor cell (DPDC) and
  third-order-terms options.
It also features support for integration of Fickian-terms in advection-diffusion
  problems using the pseudo-transport velocity approach.
In 2D and 3D simulations, domain-decomposition is used for multi-threaded parallelism.</p>

<p>PyMPDATA is engineered purely in Python targeting both performance and usability,
    the latter encompassing research users', developers' and maintainers' perspectives.
From researcher's perspective, PyMPDATA offers hassle-free installation on multitude
  of platforms including Linux, OSX and Windows, and eliminates compilation stage
  from the perspective of the user.
From developers' and maintainers' perspective, PyMPDATA offers a suite of unit tests,
  multi-platform continuous integration setup,
  seamless integration with Python development aids including debuggers and profilers.</p>

<p>PyMPDATA design features
  a custom-built multi-dimensional Arakawa-C grid layer allowing
  to concisely represent multi-dimensional stencil operations on both
  scalar and vector fields.
The grid layer is built on top of NumPy's ndarrays (using "C" ordering)
  using the Numba's <code>@jit(nopython=True)</code> functionality for high-performance array traversals.
It enables one to code once for multiple dimensions, and automatically
  handles (and hides from the user) any halo-filling logic related with boundary conditions.
Numba <code>prange()</code> functionality is used for implementing multi-threading
  (it offers analogous functionality to OpenMP parallel loop execution directives).
The Numba's deviation from Python semantics rendering <a href="https://numba.pydata.org/numba-doc/dev/reference/pysemantics.html#global-and-closure-variables">closure variables
  as compile-time constants</a>
  is extensively exploited within <code><a href="">PyMPDATA</a></code>
  code base enabling the just-in-time compilation to benefit from
  information on domain extents, algorithm variant used and problem
  characteristics (e.g., coordinate transformation used, or lack thereof).</p>

<h1 id="tutorial-in-python-julia-rust-and-matlab">Tutorial (in Python, Julia, Rust and Matlab)</h1>

<h2 id="options-class">Options class</h2>

<p>The <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/options.html"><code>Options</code></a> class
groups both algorithm variant options as well as some implementation-related
flags that need to be set at the first place. All are set at the time
of instantiation using the following keyword arguments of the constructor
(all having default values indicated below):</p>

<ul>
<li><code>n_iters: int = 2</code>: number of iterations (2 means upwind + one corrective iteration)</li>
<li><code>infinite_gauge: bool = False</code>: flag enabling the infinite-gauge option (does not maintain sign of the advected field, thus in practice implies switching flux corrected transport on)</li>
<li><code>divergent_flow: bool = False</code>: flag enabling divergent-flow terms when calculating antidiffusive velocity</li>
<li><code>nonoscillatory: bool = False</code>: flag enabling the non-oscillatory or monotone variant (a.k.a flux-corrected transport option, FCT)</li>
<li><code>third_order_terms: bool = False</code>: flag enabling third-order terms</li>
<li><code>epsilon: float = 1e-15</code>: value added to potentially zero-valued denominators</li>
<li><code>non_zero_mu_coeff: bool = False</code>: flag indicating if code for handling the Fickian term is to be optimised out</li>
<li><code>DPDC: bool = False</code>: flag enabling double-pass donor cell option (recursive pseudovelocities)</li>
<li><code>dimensionally_split: bool = False</code>: flag disabling cross-dimensional terms in antidiffusive velocity</li>
<li><code>dtype: np.floating = np.float64</code>: floating point precision</li>
</ul>

<p>For a discussion of the above options, see e.g., <a href="https://doi.org/10.1006/jcph.1998.5901">Smolarkiewicz &amp; Margolin 1998</a>,
<a href="https://doi.org/10.5194/gmd-8-1005-2015">Jaruga, Arabas et al. 2015</a> and <a href="https://doi.org/10.5194/gmd-15-3879-2022">Olesik et al. 2020</a>
(the last with examples using PyMPDATA).</p>

<p>In most use cases of PyMPDATA, the first thing to do is to instantiate the
<a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/options.html"><code>Options</code></a> class
with arguments suiting the problem at hand, e.g.:</p>

<p><details>
<summary>Julia code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">Pkg</span>
<span class="n">Pkg</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s">&quot;PyCall&quot;</span><span class="p">)</span>
<span class="k">using</span><span class="w"> </span><span class="n">PyCall</span>
<span class="n">Options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Options</span>
<span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Options</span><span class="p">(</span><span class="n">n_iters</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Matlab code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Options</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">importlib</span><span class="p">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;PyMPDATA&#39;</span><span class="p">).</span><span class="n">Options</span><span class="p">;</span>
<span class="n">options</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Options</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="s">&#39;n_iters&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Rust code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">use</span><span class="w"> </span><span class="n">pyo3</span><span class="p">::</span><span class="n">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>
<span class="k">use</span><span class="w"> </span><span class="n">pyo3</span><span class="p">::</span><span class="n">types</span><span class="p">::{</span><span class="n">IntoPyDict</span><span class="p">,</span><span class="w"> </span><span class="n">PyDict</span><span class="p">,</span><span class="w"> </span><span class="n">PyTuple</span><span class="p">};</span>

<span class="k">fn</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">-&gt;</span><span class="w"> </span><span class="nc">PyResult</span><span class="o">&lt;</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Python</span><span class="p">::</span><span class="n">with_gil</span><span class="p">(</span><span class="o">|</span><span class="n">py</span><span class="o">|</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">options_args</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="s">&quot;n_iters&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)].</span><span class="n">into_py_dict_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">import_bound</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;Options&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">call</span><span class="p">((),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">options_args</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
</code></pre>
</div>

<p></details></p>

<p><details open>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">PyMPDATA</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>
<span class="n">options</span> <span class="o">=</span> <span class="n">Options</span><span class="p">(</span><span class="n">n_iters</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<p></details></p>

<h2 id="arakawa-c-grid-layer-and-boundary-conditions">Arakawa-C grid layer and boundary conditions</h2>

<p>In PyMPDATA, the solution domain is assumed to extend from the
first cell's boundary to the last cell's boundary (thus the
first scalar field value is at $[\Delta x/2, \Delta y/2]$.
The <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/scalar_field.html"><code>ScalarField</code></a>
and <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/vector_field.html"><code>VectorField</code></a> classes implement the
<a href="https://en.wikipedia.org/wiki/Arakawa_grids#Arakawa_C-grid">Arakawa-C staggered grid</a> logic
in which:</p>

<ul>
<li>scalar fields are discretised onto cell centres (one value per cell),</li>
<li>vector field components are discretised onto cell walls.</li>
</ul>

<p>The schematic of the employed grid/domain layout in two dimensions is given below
(with the Python code snippet generating the figure as a part of CI workflow):
<img src="https://github.com/open-atmos/PyMPDATA/releases/download/tip/readme_grid.png" alt="plot" /></p>

<p><details>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">pyplot</span>

<span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="mf">.2</span><span class="p">,</span> <span class="mf">.3</span>
<span class="n">grid</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">pyplot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span>
        <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dx</span> <span class="p">:</span> <span class="n">dx</span><span class="p">,</span>
        <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dy</span> <span class="p">:</span> <span class="n">dy</span>
    <span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;scalar-field values at cell centres&#39;</span>
<span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span>
        <span class="mi">0</span> <span class="p">:</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dx</span> <span class="p">:</span> <span class="n">dx</span><span class="p">,</span>
        <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">dy</span> <span class="p">:</span> <span class="n">dy</span>
    <span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.005</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;vector-field x-component values at cell walls&#39;</span>
<span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span>
        <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">:</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">dx</span> <span class="p">:</span> <span class="n">dx</span><span class="p">,</span>
        <span class="mi">0</span><span class="p">:</span> <span class="p">(</span><span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">dy</span> <span class="p">:</span> <span class="n">dy</span>
    <span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;mid&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">.005</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;vector-field y-component values at cell walls&#39;</span>
<span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">dy</span><span class="p">,</span> <span class="n">grid</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;staggered grid layout (grid=</span><span class="si">{</span><span class="n">grid</span><span class="si">}</span><span class="s1">, dx=</span><span class="si">{</span><span class="n">dx</span><span class="si">}</span><span class="s1">, dy=</span><span class="si">{</span><span class="n">dy</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">.1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;readme_grid.png&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p></details></p>

<p>The <code>__init__</code> methods of
<a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/scalar_field.html"><code>ScalarField</code></a>
and <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/vector_field.html"><code>VectorField</code></a>
have the following signatures:</p>

<ul>
<li><a href="https://github.com/open-atmos/PyMPDATA/blob/main/PyMPDATA/scalar_field.py"><code>ScalarField(data: np.ndarray, halo: int, boundary_conditions)</code></a></li>
<li><a href="https://github.com/open-atmos/PyMPDATA/blob/main/PyMPDATA/vector_field.py"><code>VectorField(data: Tuple[np.ndarray, ...], halo: int, boundary_conditions)</code></a>
The <code>data</code> parameters are expected to be Numpy arrays or tuples of Numpy arrays, respectively.
The <code>halo</code> parameter is the extent of ghost-cell region that will surround the
data and will be used to implement boundary conditions.
Its value (in practice 1 or 2) is
dependent on maximal stencil extent for the MPDATA variant used and
can be easily obtained using the <code>Options.n_halo</code> property.</li>
</ul>

<p>As an example, the code below shows how to instantiate a scalar
and a vector field given a 2D constant-velocity problem,
using a grid of 24x24 points, Courant numbers of -0.5 and -0.25
in "x" and "y" directions, respectively, with periodic boundary
conditions and with an initial Gaussian signal in the scalar field
(settings as in Fig.&nbsp;5 in <a href="https://doi.org/10.3233/SPR-140379">Arabas et al. 2014</a>):</p>

<p><details>
<summary>Julia code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">ScalarField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">ScalarField</span>
<span class="n">VectorField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">VectorField</span>
<span class="n">Periodic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;<a href="PyMPDATA/boundary_conditions.html">PyMPDATA.boundary_conditions</a>&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Periodic</span>

<span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span>
<span class="n">Cx</span><span class="p">,</span><span class="w"> </span><span class="n">Cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">-</span><span class="mf">.5</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">.25</span>
<span class="n">idx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">CartesianIndices</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="p">))</span>
<span class="n">halo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="o">.</span><span class="n">n_halo</span>
<span class="n">advectee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ScalarField</span><span class="p">(</span>
<span class="w">    </span><span class="n">data</span><span class="o">=</span><span class="n">exp</span><span class="o">.</span><span class="p">(</span>
<span class="w">        </span><span class="o">-</span><span class="p">(</span><span class="n">getindex</span><span class="o">.</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<span class="w">        </span><span class="o">-</span><span class="p">(</span><span class="n">getindex</span><span class="o">.</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="mf">.5</span><span class="w"> </span><span class="o">.-</span><span class="w"> </span><span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span>
<span class="w">    </span><span class="p">),</span>
<span class="w">    </span><span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">,</span>
<span class="w">    </span><span class="n">boundary_conditions</span><span class="o">=</span><span class="p">(</span><span class="n">Periodic</span><span class="p">(),</span><span class="w"> </span><span class="n">Periodic</span><span class="p">())</span>
<span class="p">)</span>
<span class="n">advector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">VectorField</span><span class="p">(</span>
<span class="w">    </span><span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">fill</span><span class="p">(</span><span class="n">Cx</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="p">)),</span><span class="w"> </span><span class="n">fill</span><span class="p">(</span><span class="n">Cy</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">))),</span>
<span class="w">    </span><span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">,</span>
<span class="w">    </span><span class="n">boundary_conditions</span><span class="o">=</span><span class="p">(</span><span class="n">Periodic</span><span class="p">(),</span><span class="w"> </span><span class="n">Periodic</span><span class="p">())</span>
<span class="p">)</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Matlab code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">ScalarField</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">importlib</span><span class="p">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;PyMPDATA&#39;</span><span class="p">).</span><span class="n">ScalarField</span><span class="p">;</span>
<span class="n">VectorField</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">importlib</span><span class="p">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;PyMPDATA&#39;</span><span class="p">).</span><span class="n">VectorField</span><span class="p">;</span>
<span class="n">Periodic</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">importlib</span><span class="p">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;<a href="PyMPDATA/boundary_conditions.html">PyMPDATA.boundary_conditions</a>&#39;</span><span class="p">).</span><span class="n">Periodic</span><span class="p">;</span>

<span class="n">nx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int32</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>
<span class="n">ny</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">int32</span><span class="p">(</span><span class="mi">24</span><span class="p">);</span>

<span class="n">Cx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">.5</span><span class="p">;</span>
<span class="n">Cy</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="o">-</span><span class="mf">.25</span><span class="p">;</span>

<span class="p">[</span><span class="n">xi</span><span class="p">,</span><span class="w"> </span><span class="n">yi</span><span class="p">]</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">meshgrid</span><span class="p">(</span><span class="nb">double</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="w"> </span><span class="nb">double</span><span class="p">(</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">:</span><span class="n">ny</span><span class="o">-</span><span class="mi">1</span><span class="p">));</span>

<span class="n">halo</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">options</span><span class="p">.</span><span class="n">n_halo</span><span class="p">;</span>
<span class="n">advectee</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">ScalarField</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">numpy</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="nb">exp</span><span class="p">(</span><span class="w"> </span><span class="k">...</span>
<span class="w">        </span><span class="o">-</span><span class="p">(</span><span class="n">xi</span><span class="o">+</span><span class="mf">.5</span><span class="o">-</span><span class="nb">double</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">double</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">...</span>
<span class="w">        </span><span class="o">-</span><span class="p">(</span><span class="n">yi</span><span class="o">+</span><span class="mf">.5</span><span class="o">-</span><span class="nb">double</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">.^</span><span class="mi">2</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">double</span><span class="p">(</span><span class="n">ny</span><span class="p">)</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">^</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="p">)),</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;halo&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">halo</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;boundary_conditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">tuple</span><span class="p">({</span><span class="n">Periodic</span><span class="p">(),</span><span class="w"> </span><span class="n">Periodic</span><span class="p">()})</span><span class="w"> </span><span class="k">...</span>
<span class="p">));</span>
<span class="n">advector</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">VectorField</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">tuple</span><span class="p">({</span><span class="w"> </span><span class="k">...</span>
<span class="w">        </span><span class="n">Cx</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">numpy</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">int32</span><span class="p">([</span><span class="n">nx</span><span class="o">+</span><span class="mi">1</span><span class="w"> </span><span class="n">ny</span><span class="p">])),</span><span class="w"> </span><span class="k">...</span>
<span class="w">        </span><span class="n">Cy</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">numpy</span><span class="p">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">int32</span><span class="p">([</span><span class="n">nx</span><span class="w"> </span><span class="n">ny</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="w"> </span><span class="k">...</span>
<span class="w">     </span><span class="p">}),</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;halo&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">halo</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">    </span><span class="s">&#39;boundary_conditions&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">tuple</span><span class="p">({</span><span class="n">Periodic</span><span class="p">(),</span><span class="w"> </span><span class="n">Periodic</span><span class="p">()})</span><span class="w"> </span><span class="k">...</span>
<span class="p">));</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Rust code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">vector_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">import_bound</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;VectorField&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">scalar_field</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">import_bound</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;ScalarField&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">periodic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">import_bound</span><span class="p">(</span><span class="s">&quot;<a href="PyMPDATA/boundary_conditions.html">PyMPDATA.boundary_conditions</a>&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;Periodic&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">nx_ny</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="mi">24</span><span class="p">,</span><span class="w"> </span><span class="mi">24</span><span class="p">];</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">cx_cy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">0.25</span><span class="p">];</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">boundary_con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyTuple</span><span class="p">::</span><span class="n">new_bound</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">periodic</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="n">periodic</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">]).</span><span class="n">into_any</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">halo</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">options</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;n_halo&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">indices</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyDict</span><span class="p">::</span><span class="n">new_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="w">    </span><span class="n">Python</span><span class="p">::</span><span class="n">run_bound</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="fm">format!</span><span class="p">(</span><span class="s">r#&quot;</span>
<span class="s">import numpy as np</span>
<span class="s">nx, ny = {}, {}</span>
<span class="s">xi, yi = np.indices((nx, ny), dtype=float)</span>
<span class="s">data=np.exp(</span>
<span class="s">  -(xi+.5-nx/2)**2 / (2*(ny/10)**2)</span>
<span class="s">  -(yi+.5-nx/2)**2 / (2*(ny/10)**2)</span>
<span class="s">)</span>
<span class="s">    &quot;#</span><span class="p">,</span><span class="w"> </span><span class="n">nx_ny</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">nx_ny</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">indices</span><span class="p">)).</span><span class="n">unwrap</span><span class="p">();</span>

<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">advectee_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[(</span><span class="s">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">indices</span><span class="p">.</span><span class="n">get_item</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;halo&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">halo</span><span class="p">.</span><span class="n">clone</span><span class="p">())),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;boundary_conditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">boundary_con</span><span class="p">))].</span><span class="n">into_py_dict_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">advectee</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">scalar_field</span><span class="p">.</span><span class="n">call</span><span class="p">((),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">advectee_arg</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">full</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyDict</span><span class="p">::</span><span class="n">new_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="w">    </span><span class="n">Python</span><span class="p">::</span><span class="n">run_bound</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="fm">format!</span><span class="p">(</span><span class="s">r#&quot;</span>
<span class="s">import numpy as np</span>
<span class="s">nx, ny = {}, {}</span>
<span class="s">Cx, Cy = {}, {}</span>
<span class="s">data = (np.full((nx + 1, ny), Cx), np.full((nx, ny + 1), Cy))</span>
<span class="s">    &quot;#</span><span class="p">,</span><span class="w"> </span><span class="n">nx_ny</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">nx_ny</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">cx_cy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">cx_cy</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="w"> </span><span class="nb">None</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">full</span><span class="p">)).</span><span class="n">unwrap</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">boundary_con</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyTuple</span><span class="p">::</span><span class="n">new_bound</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">periodic</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">,</span><span class="w"> </span><span class="n">periodic</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">]).</span><span class="n">into_any</span><span class="p">();</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">advector_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[(</span><span class="s">&quot;data&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">full</span><span class="p">.</span><span class="n">get_item</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;halo&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">halo</span><span class="p">.</span><span class="n">clone</span><span class="p">())),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;boundary_conditions&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">boundary_con</span><span class="p">))].</span><span class="n">into_py_dict_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">advector</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">vector_field</span><span class="p">.</span><span class="n">call</span><span class="p">((),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">advector_arg</span><span class="p">))</span><span class="o">?</span><span class="p">;</span>
</code></pre>
</div>

<p></details></p>

<p><details open>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">PyMPDATA</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScalarField</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">PyMPDATA</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorField</span>
<span class="kn">from</span><span class="w"> </span><span class="nn"><a href="PyMPDATA/boundary_conditions.html">PyMPDATA.boundary_conditions</a></span><span class="w"> </span><span class="kn">import</span> <span class="n">Periodic</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">=</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">24</span>
<span class="n">Cx</span><span class="p">,</span> <span class="n">Cy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">.25</span>
<span class="n">halo</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">n_halo</span>

<span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">advectee</span> <span class="o">=</span> <span class="n">ScalarField</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
    <span class="o">-</span><span class="p">(</span><span class="n">xi</span><span class="o">+</span><span class="mf">.5</span><span class="o">-</span><span class="n">nx</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">nx</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="o">-</span><span class="p">(</span><span class="n">yi</span><span class="o">+</span><span class="mf">.5</span><span class="o">-</span><span class="n">ny</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">ny</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
  <span class="p">),</span>
  <span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">,</span>
  <span class="n">boundary_conditions</span><span class="o">=</span><span class="p">(</span><span class="n">Periodic</span><span class="p">(),</span> <span class="n">Periodic</span><span class="p">())</span>
<span class="p">)</span>
<span class="n">advector</span> <span class="o">=</span> <span class="n">VectorField</span><span class="p">(</span>
  <span class="n">data</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ny</span><span class="p">),</span> <span class="n">Cx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span> <span class="o">+</span> <span class="mi">1</span><span class="p">),</span> <span class="n">Cy</span><span class="p">)),</span>
  <span class="n">halo</span><span class="o">=</span><span class="n">halo</span><span class="p">,</span>
  <span class="n">boundary_conditions</span><span class="o">=</span><span class="p">(</span><span class="n">Periodic</span><span class="p">(),</span> <span class="n">Periodic</span><span class="p">())</span>
<span class="p">)</span>
</code></pre>
</div>

<p></details></p>

<p>Note that the shapes of arrays representing components
of the velocity field are different than the shape of
the scalar field array due to employment of the staggered grid.</p>

<p>Besides the exemplified <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/boundary_conditions/periodic.html"><code>Periodic</code></a> class representing
periodic boundary conditions, PyMPDATA supports
<a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/boundary_conditions/extrapolated.html"><code>Extrapolated</code></a>,
<a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/boundary_conditions/constant.html"><code>Constant</code></a> and
<a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/boundary_conditions/polar.html"><code>Polar</code></a>
boundary conditions.</p>

<h2 id="stepper">Stepper</h2>

<p>The logic of the MPDATA iterative solver is represented
in PyMPDATA by the <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/stepper.html"><code>Stepper</code></a> class.</p>

<p>When instantiating the <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/stepper.html"><code>Stepper</code></a>, the user has a choice
of either supplying just the  number of dimensions or specialising the stepper for a given grid:
<details>
<summary>Julia code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Stepper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Stepper</span>

<span class="n">stepper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stepper</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="n">n_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<p></details>
<details>
<summary>Matlab code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Stepper</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">importlib</span><span class="p">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;PyMPDATA&#39;</span><span class="p">).</span><span class="n">Stepper</span><span class="p">;</span>

<span class="n">stepper</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Stepper</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="k">...</span>
<span class="w">  </span><span class="s">&#39;options&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">  </span><span class="s">&#39;n_dims&#39;</span><span class="p">,</span><span class="w"> </span><span class="nb">int32</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="w"> </span><span class="k">...</span>
<span class="p">));</span>
</code></pre>
</div>

<p></details>
<details open></p>

<p><details>
<summary>Rust code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kd">let</span><span class="w"> </span><span class="n">n_dims</span><span class="p">:</span><span class="w"> </span><span class="kt">i32</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span>
<span class="kd">let</span><span class="w"> </span><span class="n">stepper_arg</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyDict</span><span class="p">::</span><span class="n">new_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyDictMethods</span><span class="p">::</span><span class="n">set_item</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stepper_arg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;options&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">);</span>
<span class="kd">let</span><span class="w"> </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">PyDictMethods</span><span class="p">::</span><span class="n">set_item</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stepper_arg</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;n_dims&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">n_dims</span><span class="p">);</span>
</code></pre>
</div>

<p></details>
<details>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">PyMPDATA</span><span class="w"> </span><span class="kn">import</span> <span class="n">Stepper</span>

<span class="n">stepper</span> <span class="o">=</span> <span class="n">Stepper</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">n_dims</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
</div>

<p></details>
or
<details>
<summary>Julia code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">stepper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Stepper</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="p">))</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Matlab code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">stepper</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Stepper</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="k">...</span>
<span class="w">  </span><span class="s">&#39;options&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">options</span><span class="p">,</span><span class="w"> </span><span class="k">...</span>
<span class="w">  </span><span class="s">&#39;grid&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">tuple</span><span class="p">({</span><span class="n">nx</span><span class="p">,</span><span class="w"> </span><span class="n">ny</span><span class="p">})</span><span class="w"> </span><span class="k">...</span>
<span class="p">));</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Rust code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">_stepper_arg_alternative</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="fm">vec!</span><span class="p">[(</span><span class="s">&quot;options&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">options</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;grid&quot;</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">PyTuple</span><span class="p">::</span><span class="n">new_bound</span><span class="p">(</span><span class="n">py</span><span class="p">,</span><span class="w"> </span><span class="n">nx_ny</span><span class="p">).</span><span class="n">into_any</span><span class="p">())].</span><span class="n">into_py_dict_bound</span><span class="p">(</span><span class="n">py</span><span class="p">);</span>
<span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">stepper_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">import_bound</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;Stepper&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w"> </span><span class="kd">let</span><span class="w"> </span><span class="n">stepper</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stepper_</span><span class="p">.</span><span class="n">call</span><span class="p">((),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="n">stepper_arg</span><span class="p">))</span><span class="o">?</span><span class="p">;</span><span class="w"> </span><span class="c1">//or use stepper args alternative</span>
</code></pre>
</div>

<p></details></p>

<p><details open>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">stepper</span> <span class="o">=</span> <span class="n">Stepper</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="p">(</span><span class="n">nx</span><span class="p">,</span> <span class="n">ny</span><span class="p">))</span>
</code></pre>
</div>

<p></details></p>

<p>In the latter case, noticeably
faster execution can be expected, however the resultant
stepper is less versatile as bound to the given grid size.
If number of dimensions is supplied only, the integration
might take longer, yet same instance of the
stepper can be used for different grids.</p>

<p>Since creating an instance of the <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/stepper.html"><code>Stepper</code></a> class
involves time-consuming compilation of the algorithm code,
the class is equipped with a cache logic - subsequent
calls with same arguments return references to previously
instantiated objects. Instances of <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/stepper.html"><code>Stepper</code></a> contain no
mutable data and are (thread-)safe to be reused.</p>

<p>The init method of <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/stepper.html"><code>Stepper</code></a> has an optional
<code>non_unit_g_factor</code> argument which is a Boolean flag
enabling handling of the G factor term which can be used to
represent coordinate transformations and/or variable fluid density.</p>

<p>Optionally, the number of threads to use for domain decomposition
in the first (non-contiguous) dimension during 2D and 3D calculations
may be specified using the optional <code>n_threads</code> argument with a
default value of <code>numba.get_num_threads()</code>. The multi-threaded
logic of PyMPDATA depends thus on settings of numba, namely on the
selected threading layer (either via <code>NUMBA_THREADING_LAYER</code> env
var or via <code>numba.config.THREADING_LAYER</code>) and the selected size of the
thread pool (<code>NUMBA_NUM_THREADS</code> env var or <code>numba.config.NUMBA_NUM_THREADS</code>).</p>

<h2 id="solver">Solver</h2>

<p>Instances of the <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/solver.html"><code>Solver</code></a> class are used to control
the integration and access solution data. During instantiation,
additional memory required by the solver is
allocated according to the options provided.</p>

<p>The only method of the <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/solver.html"><code>Solver</code></a> class besides the
init is <a href="https://open-atmos.github.io/PyMPDATA/PyMPDATA/solver.html#Solver.advance"><code>advance(n_steps, mu_coeff, ...)</code></a>
which advances the solution by <code>n_steps</code> timesteps, optionally
taking into account a given diffusion coefficient <code>mu_coeff</code>.</p>

<p>Solution state is accessible through the <code>Solver.advectee</code> property.
Multiple solver[s] can share a single stepper, e.g., as exemplified in the shallow-water system solution in the examples package.</p>

<p>Continuing with the above code snippets, instantiating
a solver and making 75 integration steps looks as follows:
<details>
<summary>Julia code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pyimport</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Solver</span>
<span class="n">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Solver</span><span class="p">(</span><span class="n">stepper</span><span class="o">=</span><span class="n">stepper</span><span class="p">,</span><span class="w"> </span><span class="n">advectee</span><span class="o">=</span><span class="n">advectee</span><span class="p">,</span><span class="w"> </span><span class="n">advector</span><span class="o">=</span><span class="n">advector</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="o">.</span><span class="n">advectee</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Matlab code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="n">Solver</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">importlib</span><span class="p">.</span><span class="n">import_module</span><span class="p">(</span><span class="s">&#39;PyMPDATA&#39;</span><span class="p">).</span><span class="n">Solver</span><span class="p">;</span>
<span class="n">solver</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">Solver</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="s">&#39;stepper&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">stepper</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;advectee&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">advectee</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;advector&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">advector</span><span class="p">));</span>
<span class="n">solver</span><span class="p">.</span><span class="n">advance</span><span class="p">(</span><span class="nb">pyargs</span><span class="p">(</span><span class="s">&#39;n_steps&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">75</span><span class="p">));</span>
<span class="n">state</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">advectee</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Rust code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solver_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">py</span><span class="p">.</span><span class="n">import_bound</span><span class="p">(</span><span class="s">&quot;PyMPDATA&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;Solver&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">solver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver_</span><span class="p">.</span><span class="n">call</span><span class="p">((),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="fm">vec!</span><span class="p">[(</span><span class="s">&quot;stepper&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">stepper</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;advectee&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">advectee</span><span class="p">),</span><span class="w"> </span><span class="p">(</span><span class="s">&quot;advector&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">advector</span><span class="p">)].</span><span class="n">into_py_dict_bound</span><span class="p">(</span><span class="n">py</span><span class="p">)))</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_state_0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;advectee&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;get&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;copy&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="n">solver</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;advance&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">call</span><span class="p">((),</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="o">&amp;</span><span class="fm">vec!</span><span class="p">[(</span><span class="s">&quot;n_steps&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">75</span><span class="p">)].</span><span class="n">into_py_dict_bound</span><span class="p">(</span><span class="n">py</span><span class="p">)))</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">solver</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;advectee&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">getattr</span><span class="p">(</span><span class="s">&quot;get&quot;</span><span class="p">)</span><span class="o">?</span><span class="p">.</span><span class="n">call0</span><span class="p">()</span><span class="o">?</span><span class="p">;</span>
<span class="w">    </span><span class="nb">Ok</span><span class="p">(())</span>
<span class="w">  </span><span class="p">})</span>
<span class="p">}</span>
</code></pre>
</div>

<p></details></p>

<p><details open>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">PyMPDATA</span><span class="w"> </span><span class="kn">import</span> <span class="n">Solver</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">Solver</span><span class="p">(</span><span class="n">stepper</span><span class="o">=</span><span class="n">stepper</span><span class="p">,</span> <span class="n">advectee</span><span class="o">=</span><span class="n">advectee</span><span class="p">,</span> <span class="n">advector</span><span class="o">=</span><span class="n">advector</span><span class="p">)</span>
<span class="n">state_0</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">advectee</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">advance</span><span class="p">(</span><span class="n">n_steps</span><span class="o">=</span><span class="mi">75</span><span class="p">)</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">advectee</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
</code></pre>
</div>

<p></details></p>

<p>Now let's plot the results using <code>matplotlib</code> roughly as in Fig.&nbsp;5 in <a href="https://doi.org/10.3233/SPR-140379">Arabas et al. 2014</a>:
<details>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">plot</span><span class="p">(</span><span class="n">psi</span><span class="p">,</span> <span class="n">zlim</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">xi</span><span class="p">,</span> <span class="n">yi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">psi</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">})</span>
    <span class="n">pyplot</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span>
        <span class="n">xi</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span>
        <span class="n">psi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">.5</span>
    <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlim</span><span class="p">(</span><span class="n">zlim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="p">,</span> <span class="n">ax</span><span class="o">.</span><span class="n">zaxis</span><span class="p">):</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">set_edgecolor</span><span class="p">(</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
        <span class="n">axis</span><span class="o">.</span><span class="n">pane</span><span class="o">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zticks</span><span class="p">([])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;x/dx&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;y/dy&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_proj_type</span><span class="p">(</span><span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
    <span class="n">cnt</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xi</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span> <span class="n">yi</span><span class="o">+</span><span class="mf">.5</span><span class="p">,</span> <span class="n">psi</span><span class="p">,</span> <span class="n">zdir</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">offset</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
    <span class="n">cbar</span> <span class="o">=</span> <span class="n">pyplot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">.1</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fraction</span><span class="o">=</span><span class="mf">.04</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cbar</span><span class="o">.</span><span class="n">norm</span>

<span class="n">zlim</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">plot</span><span class="p">(</span><span class="n">state_0</span><span class="p">,</span> <span class="n">zlim</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;readme_gauss_0.png&#39;</span><span class="p">)</span>
<span class="n">plot</span><span class="p">(</span><span class="n">state</span><span class="p">,</span> <span class="n">zlim</span><span class="p">,</span> <span class="n">norm</span><span class="p">)</span>
<span class="n">pyplot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;readme_gauss.png&#39;</span><span class="p">)</span>
</code></pre>
</div>

<p></details></p>

<p><img src="https://github.com/open-atmos/PyMPDATA/releases/download/tip/readme_gauss_0.png" alt="plot" />
<img src="https://github.com/open-atmos/PyMPDATA/releases/download/tip/readme_gauss.png" alt="plot" /></p>

<h1 id="debugging">Debugging</h1>

<p>PyMPDATA relies heavily on Numba to provide high-performance
number crunching operations. Arguably, one of the key advantage
of embracing Numba is that it can be easily switched off. This
brings multiple-order-of-magnitude drop in performance, yet
it also make the entire code of the library susceptible to
interactive debugging, one way of enabling it is by setting the
following environment variable before importing PyMPDATA:
<details>
<summary>Julia code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nb">ENV</span><span class="p">[</span><span class="s">&quot;NUMBA_DISABLE_JIT&quot;</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;1&quot;</span>
</code></pre>
</div>

<p></details></p>

<p><details>
<summary>Matlab code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="nb">setenv</span><span class="p">(</span><span class="s">&#39;NUMBA_DISABLE_JIT&#39;</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;1&#39;</span><span class="p">);</span>
</code></pre>
</div>

<p></details></p>

<p><details open>
<summary>Python code (click to expand)</summary></p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;NUMBA_DISABLE_JIT&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;1&quot;</span>
</code></pre>
</div>

<p></details></p>

<h1 id="contributing-reporting-issues-seeking-support">Contributing, reporting issues, seeking support</h1>

<p>See <a href="https://github.com/open-atmos/PyMPDATA/tree/main/README.md">README.md</a>.</p>

<h1 id="other-open-source-mpdata-implementations">Other open-source MPDATA implementations:</h1>

<ul>
<li>mpdat_2d in babyEULAG (FORTRAN)
<a href="https://github.com/igfuw/bE_SDs/blob/master/babyEULAG.SDs.for#L741">https://github.com/igfuw/bE_SDs/blob/master/babyEULAG.SDs.for#L741</a></li>
<li>mpdata-oop (C++, Fortran, Python)
<a href="https://github.com/igfuw/mpdata-oop">https://github.com/igfuw/mpdata-oop</a></li>
<li>apc-llc/mpdata (C++)
<a href="https://github.com/apc-llc/mpdata">https://github.com/apc-llc/mpdata</a></li>
<li>libmpdata++ (C++):
<a href="https://github.com/igfuw/libmpdataxx">https://github.com/igfuw/libmpdataxx</a></li>
<li>AtmosFOAM:
<a href="https://github.com/AtmosFOAM/AtmosFOAM/tree/947b192f69d973ea4a7cfab077eb5c6c6fa8b0cf/applications/solvers/advection/MPDATAadvectionFoam">https://github.com/AtmosFOAM/AtmosFOAM/tree/947b192f69d973ea4a7cfab077eb5c6c6fa8b0cf/applications/solvers/advection/MPDATAadvectionFoam</a></li>
<li>advectionHPCtester (Fortran, CUDA, C preprocessor):
<a href="https://zenodo.org/records/8178549">https://zenodo.org/records/8178549</a></li>
<li>PISM (C++, 2D only):
<a href="https://github.com/pism/pism/blob/main/src/geometry/MPDATA2.cc">https://github.com/pism/pism/blob/main/src/geometry/MPDATA2.cc</a></li>
<li>ROMS (Fortran):
<a href="https://github.com/myroms/roms/blob/main/ROMS/Nonlinear/mpdata_adiff.F">https://github.com/myroms/roms/blob/main/ROMS/Nonlinear/mpdata_adiff.F</a></li>
<li>sbPOM (Fortran):
<a href="https://github.com/RinceWND/extPOM/blob/master/pom/solver.f">https://github.com/RinceWND/extPOM/blob/master/pom/solver.f</a></li>
<li>TourOfJulia (Julia):
<a href="https://github.com/themantra108/TourOfJulia.jl/blob/master/06b_smolarkiewicz.jl">https://github.com/themantra108/TourOfJulia.jl/blob/master/06b_smolarkiewicz.jl</a></li>
</ul>

<h1 id="other-python-packages-for-solving-hyperbolic-transport-equations">Other Python packages for solving hyperbolic transport equations</h1>

<ul>
<li>PyPDE: <a href="https://pypi.org/project/PyPDE/">https://pypi.org/project/PyPDE/</a></li>
<li>FiPy: <a href="https://pypi.org/project/FiPy/">https://pypi.org/project/FiPy/</a></li>
<li>ader: <a href="https://pypi.org/project/ader/">https://pypi.org/project/ader/</a></li>
<li>centpy: <a href="https://pypi.org/project/centpy/">https://pypi.org/project/centpy/</a></li>
<li>mattflow: <a href="https://pypi.org/project/mattflow/">https://pypi.org/project/mattflow/</a></li>
<li>FastFD: <a href="https://pypi.org/project/FastFD/">https://pypi.org/project/FastFD/</a></li>
<li>Pyclaw: <a href="https://www.clawpack.org/pyclaw/">https://www.clawpack.org/pyclaw/</a></li>
</ul>
</div>

                        <input id="mod-PyMPDATA-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-PyMPDATA-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos"> 1</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos"> 2</span></a><span class="sd">.. include:: ../docs/markdown/pympdata_landing.md</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos"> 3</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos"> 4</span></a>
</span><span id="L-5"><a href="#L-5"><span class="linenos"> 5</span></a><span class="c1"># pylint: disable=invalid-name</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos"> 6</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">PackageNotFoundError</span><span class="p">,</span> <span class="n">version</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos"> 7</span></a>
</span><span id="L-8"><a href="#L-8"><span class="linenos"> 8</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">Options</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos"> 9</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.scalar_field</span><span class="w"> </span><span class="kn">import</span> <span class="n">ScalarField</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">10</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.solver</span><span class="w"> </span><span class="kn">import</span> <span class="n">Solver</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">11</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.stepper</span><span class="w"> </span><span class="kn">import</span> <span class="n">Stepper</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">12</span></a><span class="kn">from</span><span class="w"> </span><span class="nn">.vector_field</span><span class="w"> </span><span class="kn">import</span> <span class="n">VectorField</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">13</span></a>
</span><span id="L-14"><a href="#L-14"><span class="linenos">14</span></a><span class="k">try</span><span class="p">:</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">15</span></a>    <span class="n">__version__</span> <span class="o">=</span> <span class="n">version</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">16</span></a><span class="k">except</span> <span class="n">PackageNotFoundError</span><span class="p">:</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">17</span></a>    <span class="c1"># package is not installed</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">18</span></a>    <span class="k">pass</span>
</span></pre></div>


            </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>